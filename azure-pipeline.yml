resources:
  pipelines:
  - pipeline: Essentials
    source: XbimEssentials
    branch: develop
    project: xBIMToolkit
    trigger:
       branches:
        include:
        - master
        - develop
        
pool:
  vmImage: 'windows-2022'

steps:
- checkout: self
  persistCredentials: true

- powershell: |
    git rm -rf .
    git checkout HEAD -- azure-pipeline.yml
    git checkout gh-pages
  displayName: 'Remove old docs files'

- download: none
- download: Essentials
  artifact: docs 

- task: CopyFiles@2
  displayName: 'Copy generated docs to repo'
  #condition: eq(variables['Build.SourceBranch'], 'refs/heads/master')
  inputs:
    SourceFolder: '$(PIPELINE.WORKSPACE)/Essentials/docs'
    Contents: |
      **
    TargetFolder: '$(System.DefaultWorkingDirectory)'
    flattenFolders: false
    OverWrite: true
 
- powershell: |
    git config --global user.email "azure.agent@xbim.net"
    git config --global user.name "azure.agent"
    git add .
    git commit -m "new docs generated"
    git push

  displayName: 'Push new docs files'
